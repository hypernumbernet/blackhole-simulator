# ブラックホールシミュレーター

重力多体シミュレーター （Qt GUI 版）

**バージョン 2.0 _β_**

Qt Framework によるデスクトップアプリケーションです。OpenGL 4.5 を使用しています。

## ダウンロード
https://github.com/hypernumbernet/blackhole-simulator/tree/version2qt/binary

## 特徴

*まだ開発中で不安定です。下記特徴は実装中です。*

このプログラムでは、多数の粒子間に働く力をエンジンとして定義していて、エンジンを切り替えながら様々な初期条件からの時間進展を検証できます。
現実世界の惑星のデータを入力して軌道を予測したり、曲がった時空間をシミュレーションすることもできます。

## 使い方

* カメラ位置の操作
  - マウスホイール : 前進と後退
  - マウス左ドラッグ : 回転
  - マウス右ドラッグ : 平行移動
  - マウス左右同時押しドラッグ : ローリング
  - マウス中クリック : 原点を見てY軸を上に
  - W-S-A-D キー : 平行移動
  - Q-E キー : ローリング
  - 矢印キー : 周囲を見る
  - スペースキー : 上下移動
  - タブキー : 原点を見てY軸を上に
  - シフトキー : XZ平面に立つ
  - エスケープ : 位置をリセット
  - ホーム／エンド : 原点接近／離脱
  - バックスペース : 原点を見る

## 開発環境

### Qt 6.2.4, Qt Creator 4, C++17

* コンパイラー : MSVC2019 または MinGW8.1 または GCC (すべて64bit)
* OS: Windows10 または Kubuntu 20.04
* ビデオカード : NVIDIA GeForce RTX 2060 super

## 技術要素

* GPGPUを使った並列化された高速数値計算。
* CPUのコアの数に最適化された可変マルチスレッドでのCPU計算のためのクラス設計。
* 3DCGのカメラ視点で制限のない動きの計算。軸に固定されたり上下の制限のない回転。

## 物理の解説

### 古典物理学の考え方

物質粒子が力によって相互作用するのは、ニュートンの式 F=ma によります。a は加速度で時間あたりの速度の変化量です。言い換えれば力とは、運動量 mv の変化量です。実際に計算するに当たっては運動量 mv の交換の計算を中心に考えると分かりやすいです。同量の運動量の交換を繰り返せば、系としては運動量は保存されます。N個の粒子の相互作用の組み合わせの数はとんでもない量になりますが、それをひたすら単純計算していきます。

### 相対性理論の考え方

相対性理論の重力は空間の歪みで考えます。質量のある物質あるいは質量のない光のようなエネルギーも周囲の空間を歪めているとします。物質粒子は周囲のエネルギーによって形成された歪みに沿って真っすぐに進みます。歪んでいない空間に居る観測者には曲がって進んでいるように見えます。

相対論でのN体シミュレーションでは、ある粒子の存在する空間のゆがみを、他のN-1個の粒子から算出し、その歪み具合に沿って粒子を真っすぐに進ませる計算をしています。このシミュレーターでは、一応惑星の軌道計算が成立しました。しかし、この計算がどれだけ正確なのかどうかは不明です。

ブラックホールが出来るほどの強い重力の条件を入力すると、変数が無限大になり発散したりするので、今の計算方法では粒子の動きがストップするようになっていたりします。その先の計算方法が悩ましく、そして悩ましいのが楽しいので、今後さらに検証していく予定です。

## 数学の解説

### 円そして超球

普通4次元を想像してと言われると、まず2次元の平面の上を粒子が相互作用する様子を考え、それを3次元に拡張しながら考えを進めていくと思います。そして4次元の形をイメージすることは出来ないでしょう。出来る人が居たら教えてください。

実はそれとは別の高次元への拡張の仕方があります。円の上しか粒子が存在せず、そこで相互作用する様子を想像してみてください。そして、円を球にしてみてください。地球の表面を思い浮かべると思います。この普通の球をさらに一つ高次元にしてみましょう。ちょっとイメージできない領域になると思います。しかし、数式的には単純に単位四元数で表すことが出来ます。これをS3空間と言うそうです。この空間での相互作用の様子を計算してみています。

### 回転計算

複素数を使うと回転の計算が簡単にできることは習った方も多いと思いますが、複素数で出来るのは2次元での回転です。3次元での回転は四元数を使います。3次元の回転の計算はかなり有用なので計算方法を書いておきます。

3次元空間での方向 a, b がそれぞれ単位ベクトルで表されているとします。a から b の方向へ t の割合だけ任意の3次元ベクトル f (fx, fy, fz) を回転させます。

* a と b の内積から算出した角度を2で割った角度 v と、a と b の外積を正規化した回転軸 e (ex, ey, ez) を算出します。
* 回転の割合 t を v にかけて、回転を表す四元数を計算します。 q = cos(vt) + i ex sin(vt) + j ey sin(vt) + k ez sin(vt)
* q の共役四元数 p を準備します。
* f を四元数化します。 F = i fx + j fy + k fz
* 四元数の掛け算で p * F * q を計算します。この結果の四元数の虚部3つが回転結果の3次元ベクトルとなります。

面倒な計算ですが、球面線形補間 slerp を行うには必須となります。
